<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>

<body onload="loadCrime()">
    <div id='container'> </div>

    <script>
        var Status = "";
        function Approve(id){
            alert("승인");
            alert("/flagApprove?id=" + id);
            xhttp.open("GET", "/flagApprove?id=" + id, true);
            xhttp.send();
        }
        
        function loadCrime() { 
            let xhttp = new XMLHttpRequest(); 
            xhttp.onreadystatechange = function() { 
                if (this.readyState == 4 && this.status == 200) {
                    let crimes = JSON.parse(this.responseText);
                    let crimeTables = "";
                    
                    for (let i = 0; i < crimes.length; i++) {
                        // TODO HTML 태그를 생성 container div에 자식으로 넣어줌
                            
                        if(crimes[i].flag == '0')
                            Status = "Approve";
                        else
                            Status = "Cancel";
                        
                        function Approve() {
                            xhttp.open("PUT", "/flagApprove/" + crimes[i].id, true);
                            xhttp.send();
                        }
                        
                        let crimeItem = "<div>" +
                            "<table width='800' border='1' bgcolor='#eeeeee'><tr>" +
                            "<td>" + crimes[i].id + "</td>" +
                            "<td>" + crimes[i].lat + "</td>" +
                            "<td>" + crimes[i].lng + "</td>" +
                            "<td>" + crimes[i].author + "</td>" +
                            "<td>" + crimes[i].time + "</td>" +
                            "<td>" + crimes[i].content + "</td>" +
                            "<td>" + crimes[i].type + "</td>" +
                            "<td>" + crimes[i].flag + "</td>" +
                            "<td><button type='button' onclick='Approve(" + crimes[i].id + ")'>" + Status + "</button></td>"
                        "</tr></table>" +
                        "</div>";

                        crimeTables += crimeItem;
                        
                    }
                    document.getElementById('container').innerHTML = crimeTables; 
                } 
            };

             
            xhttp.open("GET", "/adminView", true);
            xhttp.send();
        }


    </script>
</body>

</html>
